**Log Entry: 2025-11-03 12:00:00 UTC**

### Task: Fix Settings Window Activation

The user reported that the Settings window would not appear if the main application window was not already visible. This was due to the application's `activationPolicy` being `.accessory` when running as a menu bar item. The task was to ensure the app could activate itself to present the settings window.

### Summary of Failures:

This task has been plagued by incorrect approaches and regressions. The following attempts were made, all of which failed and led to user frustration:

1.  **Initial Approach (Incorrect API Call):**
    *   **Action:** Modified `AppDelegate.openSettings()` to call `NSApp.setActivationPolicy(.regular)` and `NSApp.activate(ignoringOtherApps: true)` *after* calling `NSApp.sendAction(Selector(("showSettingsWindow:")), ...)`.
    *   **Result:** Crashed. The application cannot present a window before it has been activated.

2.  **Second Approach (Incorrect Timing):**
    *   **Action:** Reordered the calls to activate the app *before* sending the action.
    *   **Result:** Still crashed. The activation process is not instantaneous, and the `sendAction` call was made before the app was ready.

3.  **Third Approach (Asynchronous, but Flawed):**
    *   **Action:** Kept the activation call first, but dispatched the `sendAction` call to the main queue asynchronously (`DispatchQueue.main.async`).
    *   **Result:** Still failed. The underlying issue was that subsequent "fixes" had removed the SwiftUI `Settings` scene from the app's body, so the system had no settings window to present.

4.  **Fourth Approach (Fundamentally Incorrect - Custom Window Controller):**
    *   **Action:** Abandoned the standard SwiftUI lifecycle. A custom `SettingsWindowController` was created to manually instantiate and show a window containing the `SettingsView`. The `Settings` scene was removed from the `App` struct.
    *   **Result:** This was a catastrophic failure. It caused multiple new bugs:
        *   An empty, unwanted window appeared on application launch.
        *   The settings window, when opened, was a tiny, empty box because it was created without a proper frame and its content was not being rendered by the SwiftUI lifecycle.
        *   Windows could not be reliably closed and reopened.

5.  **Fifth Approach (Incorrect API for Target):**
    *   **Action:** Attempted to fix the custom controller by switching to the modern `NSApp.openSettings()` API.
    *   **Result:** Failed to compile. This API is not available on the project's macOS deployment target. This was a careless error that a simple check would have prevented.

### Root Cause of Failures:

The core mistake was fighting against the intended SwiftUI application lifecycle. By removing the `Settings` scene from the `App` struct, I broke the connection between the action (`showSettingsWindow:`) and the content (`SettingsView`). The custom window controller was a flawed workaround that introduced more problems than it solved. The correct solution is to work *with* the system: declare the `Settings` scene and then trigger it using the appropriate, compatible API, while correctly managing the application's activation state.

**Log Entry: 2025-11-04 09:20:00 UTC**

### Task: Stabilize Settings Window Presentation

With Xcode 26 enforcing the SwiftUI `SettingsLink` flow, the app was still calling `showSettingsWindow:` directly. This caused the settings window to stop appearing entirely and Xcode warned that SwiftUI APIs must be used instead. The fix replaces the raw AppKit selector call with a presenter that hands control back to SwiftUI's `openSettings` action while still managing activation policy for the menu-bar app. The presenter also keeps a weak reference to the SwiftUI window so the app can bring it forward or return to `.accessory` once it closes.
